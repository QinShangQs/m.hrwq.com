<?php $__env->startSection('content'); ?>
<div id="subject">
    <div id="main">
        <?php if($share_user): ?>
            <div class="popupWindow" style="cursor:pointer;vertical-align:middle">
                <div class="popupWindow_hp"></div>
                <div class="popupWindow_frame" style="background:url() left top repeat;top:30%">
                    <div class="glr_div1">
                        <div class="glr_close"><img src="/images/look/glr_close.png" alt=""/></div>
                        <div class="glr_button glr_button1">立即领取</div>
                    </div>
                    <div class="glr_div2" style="display:none;">
                        <div class="glr_close"><img src="/images/look/glr_close.png" alt=""/></div>
                        <div class="glr_prize">红包</div>
                        <a href="<?php echo e(route('user.coupon')); ?>" class="glr_button glr_button2">我的优惠券</a>
                    </div>
                </div>
            </div>
        <?php endif; ?>
        <input type="hidden" name="id" id="id" value="<?php echo e($course->id); ?>">
        <input type="hidden" name="requestUri" id="requestUri" value="<?php echo e($requestUri); ?>">

        <div class="look_charge_details">
            <div class="lcd_banner">
                <div class="lcd_banner_img"><img src="<?php echo e($course->picture); ?>" alt=""/></div>
                <div class="lcd_banner_div">
                    <div class="lcd_banner_title"><?php echo e($course->title); ?></div>
                    <div class="lcd_banner_span">
                        <?php if($course->type == 1): ?>
                            <span class="lcd_banner_span_1">免费</span>
                        <?php else: ?>
                            <span class="lcd_banner_span_1">¥<?php echo e($course->price); ?></span> 
                            <span class="lcd_banner_span_2">¥<?php echo e($course->original_price); ?></span> 
                        <?php endif; ?>
                    </div>
                </div>
            </div>
            <ul class="lcd_tab">
                <li id="lcd_tab_1" class="selected">课程详情</li>
                <li id="lcd_tab_2">评价</li>
                <li id="lcd_tab_3">推荐课程</li>
            </ul>
            <div class="lcd_div">
                <div class="lcd_div_1">
                    <dl>
                        <?php if($course->course_date): ?> 
                        <dt>课程时间</dt>
                        <dd><p>
                            <?php echo e($course->course_date); ?></p></dd>
                         <?php endif; ?>
                        <dt>具体地址</dt>
                        <dd><p><?php if($course->course_addr): ?><?php echo e($course->course_addr); ?><?php else: ?> 未填写 <?php endif; ?></p></dd>
                        <dt>适合对象</dt>
                        <dd><p><?php if($course->suitable): ?><?php echo nl2br($course->suitable); ?><?php else: ?> 未填写 <?php endif; ?></p></dd>
                        <dt>老师介绍</dt>
                        <dd>
                            <?php if($course->teacher_intr): ?>
                            <div><?php echo nl2br($course->teacher_intr); ?></div>
                            <?php else: ?>
                            <p>未填写</p>
                            <?php endif; ?>
                        </dd>
                        <dt>课程安排</dt>
                        <dd>
                            <?php if($course->course_arrange): ?>
                            <article><?php echo nl2br($course->course_arrange); ?></article>
                            <?php else: ?>
                            <p>未填写</p>
                            <?php endif; ?>
                        </dd>
                    </dl>
                </div>
                <div class="lcd_div_2" style="display:none;">
                    <ul class="lcd_div_2_list">
                        <?php foreach($course_comments as $course_comment): ?>
                        <li>
                            <div class="lcd_div_2_list_img"><img src="<?php echo e(url($course_comment->user->profileIcon)); ?>" alt=""/></div>
                            <div class="lcd_div_2_list_title"><?php echo e($course_comment->user->nickname); ?></div><!--需要链接直接加a标签就行-->
                            <div class="lcd_div_2_list_time"><?php echo e($course_comment->created_at); ?></div><!--需要链接直接加a标签就行-->
                            <div class="lcd_div_2_list_p"><?php echo e($course_comment->content); ?></div><!--需要链接直接加a标签就行-->
                            <div class="opo_div_list_zambia"
                                 data-id="<?php echo e($course_comment->id); ?>"><?php echo e($course_comment->likes?$course_comment->likes:''); ?> <?php if(count($course_comment->like_records)>0): ?>
                                    <img src="/images/public/zambia_on.png" alt=""/><?php else: ?><img
                                            src="/images/public/zambia.png" alt=""/><?php endif; ?></div>
                        </li>
                        <?php endforeach; ?>
                    </ul>
                </div>
                <div class="lcd_div_3" style="display:none;">
                    <ul>
                        <?php foreach($recommend_courses as $recommend_course): ?>
                        <li>
                            <dl>
                                <dt><a href="<?php echo e(route('course.detail',['id'=>$recommend_course->id])); ?>"><img src="<?php if($recommend_course->picture): ?><?php echo e($recommend_course->picture); ?><?php endif; ?>" alt=""/></a></dt>
                                <dd><a href="<?php echo e(route('course.detail',['id'=>$recommend_course->id])); ?>"><?php echo e($recommend_course->title); ?></a></dd>
                            </dl>
                        </li>
                        <?php endforeach; ?>
                    </ul>
                    <div class="clearboth"></div>
                </div>
            </div>
            <!--lcd_collection_no是未收藏，lcd_collection_yes是已收藏-->
            <div id="is_favor" <?php if($userfavor): ?> class="lcd_collection lcd_collection_yes" <?php else: ?> class="lcd_collection lcd_collection_no" <?php endif; ?>></div>
            
            <!-- 评论 参加过该课程，方可进行评论-->
            <?php if($orderPaid): ?>

            <?php endif; ?>
            <a class="lcd_evaluate lcd_evaluate_fa" href="<?php echo e(route('course.comment',['id'=>$course->id])); ?>">评论</a>
            <!--免费课程没有一键咨询-->
            <?php if($course->type == 1): ?>
                <?php if(!$order && !$orderPaid): ?>
                <div class="lcd_button">参加该课程</div>
                <?php endif; ?>
            <?php else: ?>
                <?php if($order&&$order->order_type=='1'&&$order->pay_method=='1'): ?>
                <div class="lcd_button1" onclick="location.href = '<?php echo e(route('wechat.course_pay')); ?>?id=<?php echo e($order->id); ?>';">去付款</div>
                <?php elseif($order&&$order->order_type=='1'&&$order->pay_method=='2'): ?>
                <div class="lcd_button1" onclick="window.location.href = '<?php echo e(route('course.line_pay_static')); ?>';">待线下付款</div>
                <?php else: ?>
                <div class="lcd_button1" id="course_add">参加该课程</div><!--当未参加时显示此项-->
                <?php endif; ?>
                <div class="lcd_button_consult">一键咨询</div>
            <?php endif; ?>
        </div>
    </div>
</div>
<?php $__env->stopSection(); ?>

<?php $__env->startSection('script'); ?>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript" charset="utf-8"></script>
<?php echo $__env->make('element.share', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
<script type="text/javascript" src="<?php echo e(url('/js/ueditor.parse.min.js')); ?>?r=1"></script>
<script type="text/javascript">
    var subscribe = '<?php echo e($subscribe); ?>';
    $(document).ready(function(){
	uParse('article');
        //分享课程
        <?php if($share_flg=='1'): ?>
            wx.config(<?php echo $wx_js->config(array("onMenuShareAppMessage", "onMenuShareTimeline"),false) ?>);
            wx.ready(function(){
                wx.onMenuShareAppMessage({
                    title: '分享课程有奖', // 分享标题
                    desc: '分享课程获取爱心红包', // 分享描述
                    link: '<?php echo e(route('course.detail',['id'=>$course->id])); ?>'+'?share_user=<?php echo e($user_id); ?>&from=singlemessage', // 分享链接
                    imgUrl: '<?php echo e(url($course->picture)); ?>', // 分享图标
                    type: '', // 分享类型,music、video或link，不填默认为link
                    dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                    success: function () { 
                        // 用户确认分享后执行的回调函数
                        shared();
                    },
                    cancel: function () { 
                        // 用户取消分享后执行的回调函数
                    }
                });
                wx.onMenuShareTimeline({
                    title: '分享课程有奖', // 分享标题
                    link: '<?php echo e(route('course.detail',['id'=>$course->id])); ?>'+'?share_user=<?php echo e($user_id); ?>&from=singlemessage', // 分享链接
                    imgUrl: '<?php echo e(url($course->picture)); ?>', // 分享图标
                    success: function () {
                        // 用户确认分享后执行的回调函数
                        shared();
                    },
                    cancel: function () {
                        // 用户取消分享后执行的回调函数
                    }
                });

            });
            Popup.init({
                popTitle:'分享课程',//此处标题随情况改变，需php调用
                popHtml:'<p>点击课程右上角将课程发送给朋友，双方将得到爱心红包</p>',//此处信息会涉及到变动，需php调用
                popOkButton:{
                    buttonDisplay:true,
                    buttonName:"确认",
                    buttonfunction:function(){
                    }
                },
                popFlash:{
                    flashSwitch:false
                }
            });
        <?php else: ?>
            wx.config(<?php echo $wx_js->config(array("onMenuShareAppMessage", "onMenuShareTimeline"),false) ?>);
            wx.ready(function(){
                wx.onMenuShareAppMessage({
                    title: '<?php echo strip_tags($course->title); ?>', // 分享标题
                    desc: '汇聚顶尖教子智慧,和润万青助您成就卓越孩子!', // 分享描述
                    link: '<?php echo e(route('course.detail',['id'=>$course->id])); ?>?from=singlemessage', // 分享链接
                    imgUrl: '<?php echo e(url($course->picture)); ?>', // 分享图标
                    type: '', // 分享类型,music、video或link，不填默认为link
                    dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                    success: function () { 
                        // 用户确认分享后执行的回调函数
                    },
                    cancel: function () { 
                        // 用户取消分享后执行的回调函数
                    }
                });
                wx.onMenuShareTimeline({
                    title: '我看到一个非常好的父母课堂，可能很适合你哟', // 分享标题
                    link: '<?php echo e(route('course.detail',['id'=>$course->id])); ?>?from=singlemessage', // 分享链接
                    imgUrl: '<?php echo e(url($course->picture)); ?>', // 分享图标
                    success: function () {
                        // 用户确认分享后执行的回调函数
                    },
                    cancel: function () {
                        // 用户取消分享后执行的回调函数
                    }
                });

            });
        <?php endif; ?>

        $(".good_looking_red").height($(document).height());
        $(".good_looking_red").width($(document).width());
        $(".glr_close").click(function(){//关闭弹窗
            $(".good_looking_red").hide();
            Popup.Close();
        });
        var locks = false;
        $(".glr_button1").click(function(){//点击立即领取
            /*-----ajax开始-----*/
             if(locks) {return false;}
             locks = true;
            //给glr_prize重新赋值
            $.ajax({
                type: 'post',
                url: '<?php echo e(route('course.get_coupon')); ?>',
                data: {id: '<?php echo e($course->id); ?>',user_id: '<?php echo e($share_user); ?>'},
                success: function (res) {
                    if (res.code == 0) {
                        $(".glr_div1").hide();
                        $(".glr_div2").show();
                        locks = false;
                    }else {
                        Popup.init({
                            popTitle:'失败',
                            popHtml:'<p>'+res.message+'</p>',
                            popFlash:{
                                flashSwitch:true,
                                flashTime:3000,
                            }
                        });
                        locks = false;
                    }
                }
            });
            //返回事件结束
            /*-----ajax结束-----*/
        });
        $(".glr_button2").click(function(){//点击立即领取
            location.href='<?php echo e(route('user.coupon')); ?>';
        });
        //点击一键咨询
        $(".lcd_button_consult").click(function(){
            <?php if(@$course->tel): ?>
            Popup.init({
                popTitle:'服务中心',//此处标题随情况改变，需php调用
                popHtml:'<p><span style="color:#ff9900;"><?php echo e($course->getTel()); ?></span>是否立即拨打电话？</p>',//此处信息会涉及到变动，需php调用
                popOkButton:{
                    buttonDisplay:true,
                    buttonName:"是",
                    buttonfunction:function(){
                        //此处填写拨打电话的脚本
                        window.location.href = 'tel://' + '<?php echo e($course->getTel()); ?>';
                    }
                },
                popCancelButton:{
                    buttonDisplay:true,
                    buttonName:"否",
                    buttonfunction:function(){}
                },
                popFlash:{
                    flashSwitch:false
                }
            });
            <?php else: ?>
            Popup.init({
                popTitle:'全国服务中心',//此处标题随情况改变，需php调用
                popHtml:'<p><span style="color:#ff9900;"><?php echo e(config('constants.opo_tel')); ?></span>是否立即拨打电话？</p>',//此处信息会涉及到变动，需php调用
                popOkButton:{
                    buttonDisplay:true,
                    buttonName:"是",
                    buttonfunction:function(){
                        //此处填写拨打电话的脚本
                        window.location.href = 'tel://' + '<?php echo e(config('constants.opo_tel')); ?>';
                    }
                },
                popCancelButton:{
                    buttonDisplay:true,
                    buttonName:"否",
                    buttonfunction:function(){}
                },
                popFlash:{
                    flashSwitch:false
                }
            });
            <?php endif; ?>
        });

        //点击参加该课程（免费）
        $(".lcd_button").click(function(){
            if ( subscribe == '0') {
            window.location.href = '<?php echo e(route('wechat.qrcode')); ?>';
            } else {
		var $this = $(this);
                var session_mobile = '<?php echo e($session_mobile); ?>';
                if (session_mobile == '') {
                    //ajax成功返回事件开始
                    //如果信息不完善执行开始（2选1）
                    Popup.init({
                        popHtml:'<p>您尚未注册，请先完成注册。</p>',
                        popOkButton:{
                            buttonDisplay:true,
                            buttonName:"去注册",
                            buttonfunction:function(){
                                //此处填写信息不完善的时候的跳转信息
                                var requestUri = $('#requestUri').val();
                                window.location.href='/user/login?url='+requestUri;
                            }
                        },
                        popCancelButton:{
                            buttonDisplay:true,
                            buttonName:"否",
                            buttonfunction:function(){}
                        },
                        popFlash:{
                            flashSwitch:false
                        }
                    });
                    return false;
                    //如果信息不完善执行结束
                }else{
		    if ($this.hasClass('disabled')) return false;
		    $this.addClass('disabled');
                    /*----------ajax开始----------*/
                    var id = $('#id').val();
                    $.ajax({
                        type: 'post',
                        url: '<?php echo e(route('course.join_free')); ?>',
                        data: {id: id},
                        success: function (res) {
			    $this.removeClass('disabled');
                            if (res.code == 0) {
                                //ajax成功返回事件开始
                                // Popup.init({
                                //     popTitle:'报名成功',
                                //     popHtml:'<p>已向您的微信号发送二维码，此验证码作为参加活动的凭证！</p>',
                                //     popFlash:{
                                //         flashSwitch:true,
                                //         flashTime:3000,
                                //     }
                                // });
                                // window.location.reload();

                                Popup.init({
                                    popTitle:'报名成功',
                                    popHtml:'<p>已向您的微信号发送二维码，此验证码作为参加活动的凭证！</p>',
                                    popOkButton:{
                                        buttonDisplay:true,
                                        buttonName:"确定",
                                        buttonfunction:function(){
                                            window.location.reload();
                                        }
                                    },
                                    popFlash:{
                                        flashSwitch:false
                                    }
                                });

                                
                                //返回成功后应跳转页面
                                //ajax成功返回事件结束
                            }else {
                                Popup.init({
                                    popTitle:'失败',
                                    popHtml:'<p>'+res.message+'</p>',
                                    popFlash:{
                                        flashSwitch:true,
                                        flashTime:3000,
                                    }
                                });
                            }
                        }
                    });
                        
                    /*----------ajax结束----------*/
                }
            }
        });

        //点击参加该课程（收费）
        $("#course_add").click(function(){
            if ( subscribe == '0') {
                window.location.href = '<?php echo e(route('wechat.qrcode')); ?>';
            } else {
                var session_mobile = '<?php echo e($session_mobile); ?>';
                if (session_mobile == '') {
                    //ajax成功返回事件开始
                    //如果信息不完善执行开始（2选1）
                    Popup.init({
                        popHtml:'<p>您尚未注册，请先完成注册。</p>',
                        popOkButton:{
                            buttonDisplay:true,
                            buttonName:"去注册",
                            buttonfunction:function(){
                                //此处填写信息完善的跳转信息
                                var requestUri = $('#requestUri').val();
                                window.location.href='/user/login?url='+requestUri;
                            }
                        },
                        popCancelButton:{
                            buttonDisplay:true,
                            buttonName:"否",
                            buttonfunction:function(){}
                        },
                        popFlash:{
                            flashSwitch:false
                        }
                    });
                    return false;
                    //如果信息不完善执行结束
                }else{
                    //返回成功后应跳转页面
                    window.location.href='<?php echo e(route('course.join_charge',['id'=>$course->id])); ?>';
                }
            } 
        });

        //tab切换
        $(".lcd_tab li").click(function(){
            if($(this).attr("class")!="selected"){
                $(".lcd_tab li").attr("class","");
                $(this).attr("class","selected");
                $(".lcd_div>div").hide();
                switch($(this).attr("id")){
                    case "lcd_tab_1":
                        $(".lcd_div_1").show();
                        break;
                    case "lcd_tab_2":
                        $(".lcd_div_2").show();
                        break;
                    case "lcd_tab_3":
                        $(".lcd_div_3").show();
                        $('.lcd_div_3 img').height($('.lcd_div_3 img').width()*91/172)
                        break;
                    default:
                        break;
                }
            }
        });
        
        //点击收藏
        var lock = false;
        $("#is_favor").click(function(){
            <?php if(!session('wechat_user')): ?>
                window.location.href = '<?php echo e(route('wechat.qrcode')); ?>';
            <?php endif; ?>
            if(lock) {return false;}
            /*----------ajax开始----------*/
            var id = $('#id').val();
            lock = true;
            $.ajax({
                type: 'post',
                url: '<?php echo e(route('course.collection')); ?>',
                data: {id: id},
                success: function (res) {
                    if (res.code == 0) {
                        //ajax成功返回事件开始
                        $("#is_favor").attr("class","lcd_collection lcd_collection_no");
                        lock = false;
                        //ajax成功返回事件结束
                    }else if(res.code == 2){
			Popup.init({
                            popHtml: '您已成功收藏该课程，可在 <b>我的</b>-<b>我的课程</b> 中查看',
                            popFlash:{
                                flashSwitch:true,
                                flashTime:2000
                            }
                        });
                        $("#is_favor").attr("class","lcd_collection lcd_collection_yes");
                        lock = false;
                    }else {
                        Popup.init({
                            popTitle:'失败',
                            popHtml:'<p>'+res.message+'</p>',
                            popFlash:{
                                flashSwitch:true,
                                flashTime:3000,
                            }
                        });
                        lock = false;
                    }
                }
            });
                
            /*----------ajax结束----------*/
        });

        //点赞
        var like_lock = false;
        $(".opo_div_list_zambia").click(function () {//点赞
            var comment_id = $(this).data("id");
            var _self = $(this);
            if (like_lock) return;
            like_lock = true;
            $.ajax({
                type: 'post',
                url: '<?php echo e(route('course.comment.like', ['id'=>$course->id])); ?>',
                data: {"comment_id": comment_id},
                success: function (res) {
                    Popup.init({
                        popHtml: res.message,
                        popFlash: {
                            flashSwitch: true,
                            flashTime: 2000
                        }
                    });
                    if (res.code == 0) {
                        _self.html(res.data + ' <img src="/images/public/zambia_on.png" alt=""/>');
                    }
                    like_lock = false;
                }
            });
        });

    });
</script>
<?php $__env->stopSection(); ?>

<?php echo $__env->make('layout.default', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>