<?php $__env->startSection('content'); ?>
<div id="subject">
    <div id="main">
        <div class="good_looking">
            <div class="gl_payment_confirm">
                <form class="glpc_form">
                    <div class="glpc_div">
                        <div class="glps_top">确认支付</div>
                        <div class="glps_title"><?php echo e($order->order_name); ?></div>
                        <div class="glps_price">￥<?php echo e($order->price); ?></div>
                    </div>
                    <div class="glpc_div">
                        <div class="glpc_div_list"><span>和润万青</span>收款方</div>
                    </div>
                    <a href="#" class="glpc_div_button">立即支付</a>
                </form>
            </div>
        </div>
    </div>
</div>
<?php $__env->stopSection(); ?>
<?php $__env->startSection('script'); ?>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
$(document).ready(function(){
    wx.config(<?php echo $wechatJs->config(array('chooseWXPay'), false) ?>);
    $(".glpc_div_button").click(function(){
        wx.chooseWXPay({
                timestamp: '<?php echo e($config['timestamp']); ?>',
                nonceStr:  '<?php echo e($config['nonceStr']); ?>',
                package:  '<?php echo e($config['package']); ?>',
                signType:  '<?php echo e($config['signType']); ?>',
                paySign:   '<?php echo e($config['paySign']); ?>', // 支付签名
                success: function () {
                   setInterval(checkStatus, 1000);
                }
          });
    });
});
function checkStatus() {
    $.ajax({
        url: "<?php echo e(route('wechat.status')); ?>",
        type: "post",
        dataType: "json",
        data: {order_id: "<?php echo e($order->id); ?>"},
        success: function (res) {
            if (res.code == 0 && res.data == "2") {
                location.href = '<?php echo e(route('user')); ?>';
            }
        },
        error: function () {
        }
    });
}
</script>
<?php $__env->stopSection(); ?>
<?php echo $__env->make('layout.default', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>